<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Intex Poollampe</title>
<link rel="icon" type="image/x-icon" href="favicon.ico">
<link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="container">
    <h2>Intex Poollampe</h2>
    <div class="content-box" onclick="removeresponse()">
        <b>GPIO und Zeiten</b>
        <form id="myForm" onsubmit="submitForm(); return false;">
            <table>
                <tr>
                    <td align="left"><label for="selectS1">Taster 1 : </label></td>
                    <td align="left">
                        <select id="S1" name="S1">
                            <option value="5">GPIO5 (D1)</option>
                            <option value="4">GPIO4 (D2)</option>
                            <option value="14">GPIO14 (D5)</option>
                            <option value="12">GPIO12 (D6)</option>
                            <option value="13">GPIO13 (D7)</option>
                        </select>
                    </td>
				</tr>
				<tr>
                    <td align="left"><label for="selectS2">Taster 2 : </label></td>
                    <td align="left">
                        <select id="S2" name="S2">
                            <option value="5">GPIO5 (D1)</option>
                            <option value="4">GPIO4 (D2)</option>
                            <option value="14">GPIO14 (D5)</option>
                            <option value="12">GPIO12 (D6)</option>
                            <option value="13">GPIO13 (D7)</option>
                        </select>
                    </td>
				</tr>
				<tr>
                    <td align="left"><label for="selectDS">DS18B20 : </label></td>
                    <td align="left">
                        <select id="DS18B20" name="DS18B20">
                            <option value="5">GPIO5 (D1)</option>
                            <option value="4">GPIO4 (D2)</option>
                            <option value="14">GPIO14 (D5)</option>
                            <option value="12">GPIO12 (D6)</option>
                            <option value="13">GPIO13 (D7)</option>
                        </select>
                    </td>
				</tr>
				<tr>
                    <td align="left"><label for="zeitTemperatur">Zeit Temperatur :</label></td>
                    <td align="left"><input type="number" id="TimeDS18B20" name="TimeDS18B20" min="10" max="300"></td>
                </tr>
                <tr>
                    <td align="left"><label for="zeitWlan">Zeit Wlan :</label></td>
                    <td align="left"><input type="number" id="TimeWlan" name="TimeWlan" min="10" max="300"></td>
                </tr>
                <tr>
                    <td colspan="2"><p><span style="font-size:10px;">Zeit in Sekunden für Sensordaten</span></p></td>
                </tr>
            </table>
        </div>
    <div id="serverResponse" class="response"></div>
    </div>
    
    <div class="button-group-large">
        <input type="submit" class="blue-button" style="width: 240px;" value="Speichern">
        <a href="index.html" class="red-button">Zurück</a>
    </div>
    </form>
    
<footer>
<p><div id="build" style=""></div></p>
</footer>

</body>

<script>

const version = "11";
        function fetchData() {
            fetch("/gpio")
            .then(response => response.json())
            .then(data => {
				document.getElementById("S1").value = data.S1.toString(); // Taster 1
				document.getElementById("S2").value = data.S2.toString(); // Taster 2
				document.getElementById("DS18B20").value = data.DS18B20.toString(); // DS18B20
				document.getElementById("TimeDS18B20").value = data.TimeDS18B20.toString(); // Zeit Temperatur
				document.getElementById("TimeWlan").value = data.TimeWlan.toString(); // Zeit Wlan

                document.getElementById("build").innerHTML = `${data.build}/` + version + ' by Andreas Borchert';

            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });
        }


function submitForm() {
    const formData = new FormData(document.getElementById("myForm"));
    const jsonData = {};
    formData.forEach((value, key) => {
        jsonData[key] = value;
        });
    
    fetch("/submitgpio", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
            },
                body: JSON.stringify(jsonData)
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.text();
    })
    .then(data => {
        console.log("Response from server:", data);
        fetchData(); // Aktualisiere die Live-Daten nach dem Absenden des Formulars
        // Zeige die Antwort des Servers als Benachrichtigung an
        const serverResponse = document.getElementById("serverResponse");
        serverResponse.innerText = data;
        serverResponse.classList.add("visible");
    })
    .catch(error => {
        console.error("Error submitting form:", error);
    });
}

// JavaScript, um die Antwort auszublenden, wenn ein Eingabefeld geändert wird

fetchData();
//setInterval(fetchData, 2000); // Aktualisiere Daten alle 5 Sekunden

function removeresponse() {
    const serverResponse = document.getElementById("serverResponse");
    serverResponse.classList.remove("visible");
}

</script>
</html>
